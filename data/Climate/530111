The main contribution of this paper is that it introduces the simultaneous capacity optimization of distributed generation (DG) and storage in grid-connected and standalone microgrids. Hourly planning of the microgrid operation is performed, taking into consideration certain characteristics of the grid and the units, together with local climate data that impact the output of non-dispatchable renewable resources. The proposed formulation constitutes a nonlinear programming problem that is solved by a sequential quadratic programming method. The model is then applied for a test case microgrid, examining both grid-connected and standalone operation. Two alternative objective functions are investigated: (a) the minimization of the total annual energy losses (TAEL), and (b) the minimization of the cost of energy (COE). Depending on the considered objective function, the results show a significant reduction in either the TAEL or the COE for the grid-connected microgrid, as well as a higher degree of independence from the main grid, which provides the capability of standalone operation. In this case, the energy storage systems play the most crucial role. Consequently, the results prove the positive effect of the proposed simultaneous capacity optimization of energy storage and DG in the cases of grid-connected and standalone microgrid operation. Â© 2014 Elsevier Ltd. All rights reserved.