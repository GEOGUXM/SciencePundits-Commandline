Energy efficient operation of microgrids, a localized grouping of controllable loads with distributed energy resources like solar photovoltaic panels, requires the development of energy management systems (EMSs) with the capability of controlling the loads so as to optimize the aggregate performance of the microgrid. In microgrids comprising of buildings of different nature (residential, commercial, industrial, etc.), where the occupants exhibit heterogeneous occupancy schedules, the objective of an effective management strategy is to optimize the aggregate performance by intelligently exploiting the occupancy schedules and the intermittent production of solar energy. This paper presents a simulation-based optimization approach for the design of an EMS in grid-connected photovoltaic-equipped microgrids with heterogeneous occupancy schedule. The microgrid exchanges energy, buying or selling it, with the main grid and the EMS optimizes an aggregate multi-objective criterion that takes into account both the energy cost and the thermal comfort of the occupants of the microgrid. Simulative results obtained using a microgrid test case developed in EnergyPlus demonstrate the effectiveness of the proposed approach: the proposed EMS strategy is shown to take advantage of the occupancy information, intelligently and automatically changing the energy demand of each building according to the occupants' behavior, and achieving relevant improvements with respect to alternative EMS strategies. Â© 2015 Elsevier Ltd.