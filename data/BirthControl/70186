Objective: To analyse the effect of community-based counselling on feeding patterns during the first 12 weeks after birth, and to study whether the effect differs by maternal HIV status, educational level or household wealth.Design: Cluster-randomized trial with fifteen clusters in each arm to evaluate an integrated package providing two pregnancy and five postnatal home visits delivered by community health workers. Infant feeding data were collected using 24 h recall of nineteen food and fluid items.Setting: A township near Durban, South Africa.Subjects: Pregnant women (1894 intervention and 2243 control) aged 17 years or more.Results: Twelve weeks after birth, 1629 (intervention) and 1865 (control) mother–infant pairs were available for analysis. Socio-economic conditions differed slightly across intervention groups, which were considered in the analyses. There was no effect on early initiation of breast-feeding. At 12 weeks of age the intervention doubled exclusive breast-feeding (OR=2·29; 95 % CI 1·80, 2·92), increased exclusive formula-feeding (OR=1·70; 95 % CI 1·28, 2·27), increased predominant breast-feeding (OR=1·71; 95 % CI 1·34, 2·19), decreased mixed formula-feeding (OR=0·68; 95 % CI 0·55, 0·83) and decreased mixed breast-feeding (OR=0·54; 95 % CI 0·44, 0·67). The effect on exclusive breast-feeding at 12 weeks was stronger among HIV-negative mothers than HIV-positive mothers (P=0·01), while the effect on mixed formula-feeding was significant only among HIV-positive mothers (P=0·03). The effect on exclusive feeding was not different by household wealth or maternal education levels.Conclusions: A perinatal intervention package delivered by community health workers was effective in increasing exclusive breast-feeding, exclusive formula-feeding and decreasing mixed feeding. Copyright © The Authors 2015 This is an Open Access article, distributed under the terms of the Creative Commons Attribution licence (http://creativecommons.org/licenses/by/3.0/), which permits unrestricted re-use, distribution, and reproduction in any medium, provided the original work is properly cited.